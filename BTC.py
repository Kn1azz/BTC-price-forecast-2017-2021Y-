import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# -------------------------------------------------------
# –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´
# -------------------------------------------------------
st.set_page_config(
    page_title="BTC Forecast Project",
    layout="wide"
)

st.title("üìà –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ Bitcoin: –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –∏ ML-–º–æ–¥–µ–ª–∏")


# -------------------------------------------------------
# 1. –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê
# -------------------------------------------------------
st.header("1. –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞")

st.write("""
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å—Å–ª–µ–¥—É–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ –ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å **–¥–Ω–µ–≤–Ω—É—é –ª–æ–≥-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å Bitcoin (t+1)**  
–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ü–µ–Ω—ã (OHLC), –æ–±—ä—ë–º–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

–ú—ã:

- –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π —Ç–∞—Ä–≥–µ—Ç (log_return)
- —Å–æ–∑–¥–∞–ª–∏ –ª–∞–≥–æ–≤—ã–µ –∏ rolling-–ø—Ä–∏–∑–Ω–∞–∫–∏
- –ø—Ä–æ–≤–µ–ª–∏ —á–µ—Å—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Train / Valid / Test
- –æ–±—É—á–∏–ª–∏ LightGBM —Å —Ä–∞–Ω–Ω–µ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
- –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑—ã
- —Å–¥–µ–ª–∞–ª–∏ –Ω–∞—É—á–Ω—ã–π –≤—ã–≤–æ–¥ –æ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ BTC
""")


# -------------------------------------------------------
# 2. –î–ê–¢–ê–°–ï–¢
# -------------------------------------------------------
st.header("2. –î–∞—Ç–∞—Å–µ—Ç")

st.write("""
–ò—Å—Ö–æ–¥–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ Bitcoin:

- **Open, High, Low, Close, Volume, Marketcap**
- –ø–µ—Ä–∏–æ–¥: *2013 ‚Äî 2021*
- –¥–ª—è –∑–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —á–∞—Å—Ç—å: **—Å 2017-01-01 –ø–æ 2021-07-06**
- –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: **1648 —Å—Ç—Ä–æ–∫**
""")

st.subheader("–ü—Ä–∏–º–µ—Ä –ø–µ—Ä–≤—ã—Ö 10 —Å—Ç—Ä–æ–∫:")
st.dataframe(pd.DataFrame({
    "Date": [
        "2017-01-01", "2017-01-02", "2017-01-03",
        "2017-01-04", "2017-01-05"
    ],
    "Open": [998, 1012, 1043, 1150, 1130],
    "High": [1020, 1060, 1160, 1170, 1200],
    "Low":  [970, 998, 1030, 1120, 1100],
    "Close":[1005, 1040, 1150, 1133, 1180],
}))
st.caption("(*–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π DataFrame ‚Äî ‚ÜôÔ∏è –∑–∞–º–µ–Ω–∏—à—å –ø–æ–∑–∂–µ*)")

# PLACEHOLDER: –≥—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã
st.write("### –ì—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã BTC (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π):")
st.image("PLACEHOLDER_PRICE_PLOT.png")



# -------------------------------------------------------
# 3. –¢–ê–†–ì–ï–¢ –ò –°–¢–ê–¶–ò–û–ù–ê–†–ù–û–°–¢–¨
# -------------------------------------------------------
st.header("3. –¢–∞—Ä–≥–µ—Ç: –ª–æ–≥-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å")

st.write("""
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Ü–µ–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç  
(–æ–Ω–∞ **–Ω–µ—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–∞**, –∏–º–µ–µ—Ç —Ç—Ä–µ–Ω–¥, –º–µ–Ω—è—é—â—É—é—Å—è –¥–∏—Å–ø–µ—Ä—Å–∏—é).

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å:


–ü–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:

- mean –æ–∫–æ–ª–æ 0
- std ‚âà 0.04
- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ
""")

# PLACEHOLDER: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ log_return
st.image("PLACEHOLDER_RET_DIST.png", caption="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π")



# -------------------------------------------------------
# 4. FEATURE ENGINEERING
# -------------------------------------------------------
st.header("4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")

st.write("""
–ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

### ‚úîÔ∏è –õ–∞–≥–∏ —Ü–µ–Ω—ã
`close_lag_1`, `close_lag_2`, `close_lag_3`, `close_lag_7`

### ‚úîÔ∏è –õ–∞–≥–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
`ret_lag_1`, `ret_lag_2`, `ret_lag_5`

### ‚úîÔ∏è Rolling-–ø—Ä–∏–∑–Ω–∞–∫–∏
- —Å–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è: 7 / 14 / 30 –¥–Ω–µ–π  
- —Å–∫–æ–ª—å–∑—è—â–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 7 / 30 –¥–Ω–µ–π  
- –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π: 30 –¥–Ω–µ–π  

### ‚úîÔ∏è EMA
`ema_7`, `ema_14`

### ‚úîÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
`weekday`, `is_weekend`

–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: **23**
""")

# PLACEHOLDER: heatmap –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π
st.image("PLACEHOLDER_HEATMAP.png", caption="–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏—á–µ–π")



# -------------------------------------------------------
# 5. –†–ê–ó–î–ï–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•
# -------------------------------------------------------
st.header("5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Train / Valid / Test")

st.write("""
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏:

- **70% Train**
- **15% Validation**
- **15% Test**

–≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —É—Ç–µ—á–∫—É –±—É–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
""")

# PLACEHOLDER: –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è split
st.image("PLACEHOLDER_SPLIT.png", caption="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è")



# -------------------------------------------------------
# 6. –ú–û–î–ï–õ–¨
# -------------------------------------------------------
st.header("6. –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å")

st.write("""
–ú—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **LightGBMRegressor**, –æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- learning_rate = 0.02  
- num_leaves = 31  
- subsample = 0.8  
- colsample_bytree = 0.8  
- n_estimators = –¥–æ 20000  
- **early_stopping –Ω–∞ 300 –∏—Ç–µ—Ä–∞—Ü–∏–π**

–í–∞–∂–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ:
–º–æ–¥–µ–ª—å –ø—Ä–µ–∫—Ä–∞—â–∞–ª–∞ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ **9‚Äì15 –¥–µ—Ä–µ–≤–µ**,  
—á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–ª—å–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –≤ –¥–∞–Ω–Ω—ã—Ö.
""")

# PLACEHOLDER: feature importance
st.image("PLACEHOLDER_FI.png", caption="Feature Importance (—Ç–æ–ø-20)")



# -------------------------------------------------------
# 7. –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–ì–ù–û–ó–ê
# -------------------------------------------------------
st.header("7. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã")

st.write("""
–ú—ã —Å—Ä–∞–≤–Ω–∏–ª–∏ –º–æ–¥–µ–ª—å —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –±–µ–π–∑–ª–∞–π–Ω–∞–º–∏:

- **Baseline 1:** ret=0 (—Ü–µ–Ω–∞ –∑–∞–≤—Ç—Ä–∞ = —Ü–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è)
- **Baseline 2:** ret=ret_lag_1

### –ú–µ—Ç—Ä–∏–∫–∏ (t+1 log-return)
| –ú–æ–¥–µ–ª—å | MAE | RMSE | DirAcc | Corr |
|-------|------|-------|---------|--------|
| baseline (0) | ~0.0338 | ~0.0457 | ~0.00 | ‚Äî |
| baseline (lag1) | —Ö—É–∂–µ | —Ö—É–∂–µ | ~0.48 | ‚Äî |
| **LightGBM** | ‚âà baseline | ‚âà baseline | ~0.48 | ‚âà0 |

**–í—ã–≤–æ–¥:** t+1 –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ BTC ‚Äî –ø–æ—á—Ç–∏ —à—É–º.
""")

# PLACEHOLDER: actual vs predicted returns
st.image("PLACEHOLDER_RET_PRED.png", caption="Actual vs Predicted Returns")

# PLACEHOLDER: actual vs predicted price
st.image("PLACEHOLDER_PRICE_PRED.png", caption="Actual vs Predicted Price")



# -------------------------------------------------------
# 8. –ì–õ–ê–í–ù–´–ô –í–´–í–û–î
# -------------------------------------------------------
st.header("8. –ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è")

st.success("""
–î–Ω–µ–≤–Ω—ã–µ –ª–æ–≥-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ Bitcoin (t+1) **–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã ML-–º–æ–¥–µ–ª—è–º–∏**,  
–∏ –¥–∞–∂–µ LightGBM –Ω–µ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç baseline ‚Äú—Ü–µ–Ω–∞ –∑–∞–≤—Ç—Ä–∞ = —Ü–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è‚Äù.

–≠—Ç–æ —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è —Å –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–æ–π:
–∫—Ä–∏–ø—Ç–æ—Ä—ã–Ω–∫–∏ –æ–±–ª–∞–¥–∞—é—Ç –≤—ã—Å–æ–∫–æ–π —à—É–º–Ω–æ—Å—Ç—å—é –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞—Ö.
""")


# -------------------------------------------------------
# 9. –ü–ï–†–°–ü–ï–ö–¢–ò–í–´
# -------------------------------------------------------
st.header("9. –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è")

st.write("""
- –ø—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞ **t+7 / t+14 / t+30**
- –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è (Up/Down)
- LSTM / GRU / Transformer –º–æ–¥–µ–ª–∏
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ (macro, sentiment)
- –ø—Ä–æ–≥–Ω–æ–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (GARCH-–ø–æ–¥—Ö–æ–¥)
""")
